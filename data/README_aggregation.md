# User Study Results Aggregation

This directory contains tools to aggregate and analyze user study results from the blind comparison test.

## ğŸ“ Files

- `aggregate_results.py` - Main aggregation script
- `example_usage.py` - Examples and test cases
- `requirements.txt` - Python dependencies

## ğŸš€ Quick Start

### Install Dependencies
```bash
pip install pandas numpy
# or
pip install -r requirements.txt
```

### Usage Examples

#### 1. Process a single user's results
```bash
python aggregate_results.py --single_result "0-1-3-1221\n0-1-17-2112\n1-1-8-1122"
```

#### 2. Process from a text file
```bash
# Save user results to user_responses.txt, then:
python aggregate_results.py --results_file user_responses.txt
```

#### 3. Process multiple users (recommended)
```bash
# Put each user's results in separate .txt files in a folder, then:
python aggregate_results.py --results_dir responses/ --csv
```

#### 4. Run example with sample data
```bash
python example_usage.py
```

## ğŸ“Š What the Script Does

### 1. **Decodes Result Codes**
- Input: `1-1-8-1122`
- Output: Method=Hunyuan, Dataset=AVSpeech, Video=8, Answers=[1,1,2,2]

### 2. **Uses Order Sheets**
- Reads `order_sheet.txt` files from comparison folders
- Maps Model A/B to actual method names
- Example: Model A = "OG_ft", Model B = "margin7"

### 3. **Calculates Statistics**
- Win rates by method
- Win rates by question type
- Video-by-video analysis
- Statistical significance (if enough users)

### 4. **Generates Reports**
- Text summary report
- CSV export for further analysis
- Detailed breakdown by video and question

## ğŸ“ˆ Output Format

### Text Report
```
==========================================
USER STUDY RESULTS ANALYSIS
==========================================

ğŸ“Š OVERALL RESULTS BY METHOD
----------------------------------------
HALLO3: 45 total wins
HUNYUAN: 52 total wins
OMNIAVATAR: 38 total wins

Win rates:
  hallo3: 33.3% (45/135)
  hunyuan: 38.5% (52/135)
  omniavatar: 28.1% (38/135)

ğŸ“‹ RESULTS BY QUESTION
----------------------------------------
Character Consistency:
  hallo3: 35.2% (16)
  hunyuan: 37.0% (17)
  omniavatar: 27.8% (13)
...
```

### CSV Export
| video_filename | method | method_a | method_b | question | method_a_wins | method_b_wins | method_a_rate | method_b_rate |
|----------------|--------|----------|----------|----------|---------------|---------------|---------------|---------------|
| video1.mp4 | hallo3 | OG_ft | margin7 | Character Consistency | 3 | 7 | 0.30 | 0.70 |

## ğŸ”¢ Result Code Format

Each line from user study results follows this pattern:
```
method-dataset-videoIndex-answers
```

Where:
- **method**: 0=hallo3, 1=hunyuan, 2=omniavatar
- **dataset**: 1=avspeech
- **videoIndex**: Index of video in mapping file
- **answers**: 4 digits, each 1=Model A or 2=Model B

Example: `1-1-8-1122`
- Method: Hunyuan (1)
- Dataset: AVSpeech (1)
- Video: Index 8
- Answers: Question 1=Model A, Question 2=Model A, Question 3=Model B, Question 4=Model B

## ğŸ“‹ Required Files Structure

The script expects this structure:
```
user_study_comparisons/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ aggregate_results.py
â”‚   â”œâ”€â”€ study_config.json
â”‚   â”œâ”€â”€ hallo3_avspeech_mapping.txt
â”‚   â”œâ”€â”€ hunyuan_avspeech_mapping.txt
â”‚   â””â”€â”€ omniavatar_avspeech_mapping.txt
â”œâ”€â”€ hallo3_NEW_avspeech_OG_vs_la_1/
â”‚   â””â”€â”€ order_sheet.txt
â”œâ”€â”€ hunyuan_NEW_avspeech_AR_vs_la_margin3/
â”‚   â””â”€â”€ order_sheet.txt
â””â”€â”€ omniavatar_NEW_avspeech_OG_vs_la/
    â””â”€â”€ order_sheet.txt
```

## âš ï¸ Important Notes

1. **Blind Test Decoding**: The script uses order_sheet.txt files to determine which method was actually Model A vs Model B for each video
2. **Multiple Users**: For statistical validity, collect responses from multiple users
3. **Data Format**: Each user's results should be in the exact format generated by the website
4. **Backup**: Keep original user response files as backup

## ğŸ”§ Troubleshooting

### Common Issues
1. **Missing order sheets**: Ensure order_sheet.txt files exist in comparison folders
2. **Invalid result codes**: Check format matches `method-dataset-videoIndex-answers`
3. **Missing mappings**: Ensure video mapping files exist in data/ folder

### Debug Mode
Add print statements or use the example script to test with sample data first.